/* This program allows you to set DMX channels over the serial port.
**
** After uploading to Arduino, switch to Serial Monitor and set the baud rate
** to 9600. You can then set DMX channels using these commands:
**
** <number>c : Select DMX channel
** <number>v : Set DMX channel to new value
**
** These can be combined. For example:
** 100c355w : Set channel 100 to value 255.
**
** For more details, and compatible Processing sketch,
** visit http://code.google.com/p/tinkerit/wiki/SerialToDmx
**
** Help and support: http://groups.google.com/group/DmxMaster */

#include <DmxMaster.h>

void setup() {
  Serial1.begin(9600); // Serial in
  Serial2.begin(9600); // Corio Out(pass through)
}

int value = 0;
int channel;

void loop() {
  int c;

  incoming = serial1.read()
switch (incoming[0]) {
    case C:
      serial2.println(incoming + 1);
      break;
    case L:
      c = (incoming + 1);
      if ((c>='0') && (c<='9')) {
        value = 10*value + c - '0';
      } else {
        if (c=='c') channel = value;
        else if (c=='w') {
          DmxMaster.write(channel, value);
        }
        value = 0;
      }
      break;
    default: 
      // if nothing else matches, do the default
      // default is optional
    break;
  }




  while(!mySerial.available());
  c = mySerial.read();
  if ((c>='0') && (c<='9')) {
    value = 10*value + c - '0';
  } else {
    if (c=='c') channel = value;
    else if (c=='w') {
      DmxMaster.write(channel, value);
    }
    value = 0;
  }
}
